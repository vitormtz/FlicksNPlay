-- This script was generated by a beta version of the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.enderecos
(
    id_endereco integer NOT NULL DEFAULT nextval('cidades_id_cidade_seq'::regclass),
    rua character varying(255) COLLATE pg_catalog."default" NOT NULL,
    numero integer NOT NULL,
    bairro character varying(255) COLLATE pg_catalog."default" NOT NULL,
    cep character(8) COLLATE pg_catalog."default" NOT NULL,
    cidade character varying(255) COLLATE pg_catalog."default" NOT NULL,
    estado character(2) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT enderecos_pkey PRIMARY KEY (id_endereco)
);

CREATE TABLE IF NOT EXISTS public.filmes
(
    id_filme integer NOT NULL DEFAULT nextval('filmes_id_filme_seq'::regclass),
    id_genero integer NOT NULL,
    nome character varying(150) COLLATE pg_catalog."default" NOT NULL,
    descricao text COLLATE pg_catalog."default" NOT NULL,
    classificacao_indicativa integer NOT NULL,
    disponivel boolean,
    vl_locacao numeric(10, 2),
    tipo "char",
    CONSTRAINT filmes_pkey PRIMARY KEY (id_filme)
);

CREATE TABLE IF NOT EXISTS public.generos
(
    id_genero integer NOT NULL DEFAULT nextval('generos_id_genero_seq'::regclass),
    nome character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT generos_pkey PRIMARY KEY (id_genero),
    CONSTRAINT unique_genero UNIQUE (nome)
);

CREATE TABLE IF NOT EXISTS public.jogos
(
    id_jogo integer NOT NULL DEFAULT nextval('jogos_id_jogo_seq'::regclass),
    id_genero integer NOT NULL,
    nome character varying(150) COLLATE pg_catalog."default" NOT NULL,
    descricao text COLLATE pg_catalog."default" NOT NULL,
    disponivel boolean,
    vl_locacao numeric(10, 2),
    classificacao_indicativa integer NOT NULL,
    tipo "char" NOT NULL,
    CONSTRAINT jogos_pkey PRIMARY KEY (id_jogo)
);

CREATE TABLE IF NOT EXISTS public.locacoes
(
    id_locacao integer NOT NULL DEFAULT nextval('locacoes_id_locacao_seq'::regclass),
    id_usuario integer NOT NULL,
    id_filme integer,
    id_jogo integer,
    vl_total numeric(10, 2) NOT NULL,
    dt_inicio date NOT NULL,
    dt_fim date,
    CONSTRAINT locacoes_pkey PRIMARY KEY (id_locacao)
);

CREATE TABLE IF NOT EXISTS public.pagamentos
(
    id_pagamento integer NOT NULL DEFAULT nextval('pagamentos_id_pagamento_seq'::regclass),
    id_tipo_pagamento integer NOT NULL,
    dt_pagamento date NOT NULL,
    CONSTRAINT pagamentos_pkey PRIMARY KEY (id_pagamento)
);

CREATE TABLE IF NOT EXISTS public.tipos_pagamentos
(
    id_tipo_pagamento integer NOT NULL DEFAULT nextval('tipos_pagamentos_id_tipo_pagamento_seq'::regclass),
    nome character varying(50) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT tipos_pagamentos_pkey PRIMARY KEY (id_tipo_pagamento)
);

CREATE TABLE IF NOT EXISTS public.usuarios
(
    id_usuario integer NOT NULL DEFAULT nextval('usuarios_id_usuario_seq'::regclass),
    id_endereco integer NOT NULL,
    nome character varying(100) COLLATE pg_catalog."default" NOT NULL,
    email character varying(100) COLLATE pg_catalog."default",
    cpf character varying(11) COLLATE pg_catalog."default" NOT NULL,
    dt_nasc date,
    senha character varying(255) COLLATE pg_catalog."default",
    nivel_acesso boolean,
    cargo character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT usuarios_pkey PRIMARY KEY (id_usuario)
);

ALTER TABLE IF EXISTS public.filmes
    ADD CONSTRAINT filme_genero_fk FOREIGN KEY (id_genero)
    REFERENCES public.generos (id_genero) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.jogos
    ADD CONSTRAINT jogo_genero_fk FOREIGN KEY (id_genero)
    REFERENCES public.generos (id_genero) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.locacoes
    ADD CONSTRAINT locacao_filme_fk FOREIGN KEY (id_filme)
    REFERENCES public.filmes (id_filme) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.locacoes
    ADD CONSTRAINT locacao_jogo_fk FOREIGN KEY (id_jogo)
    REFERENCES public.jogos (id_jogo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.locacoes
    ADD CONSTRAINT locacao_usuario_fk FOREIGN KEY (id_usuario)
    REFERENCES public.usuarios (id_usuario) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.tipos_pagamentos
    ADD CONSTRAINT pagament_tipo_pagamento_fk FOREIGN KEY (id_tipo_pagamento)
    REFERENCES public.pagamentos (id_tipo_pagamento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.usuarios
    ADD CONSTRAINT usuario_endereco_fk FOREIGN KEY (id_endereco)
    REFERENCES public.enderecos (id_endereco) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

END;